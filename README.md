# üå°Ô∏è Demo Flask IoT - Monitor de Sensores ESP32

Proyecto educativo para aprender a monitorear sensores IoT en tiempo real usando Flask y ESP32 (simulado en Wokwi).

---

## üìã ¬øQu√© hace este proyecto?

Este sistema te permite:
1. **Simular un sensor ESP32** que mide temperatura y humedad
2. **Enviar los datos** a un servidor web Flask
3. **Visualizar en tiempo real** los valores en un dashboard web
4. **Monitorear el estado** de conexi√≥n del dispositivo

---

## üéØ Caracter√≠sticas principales

- ‚úÖ Dashboard web en tiempo real
- ‚úÖ Indicador visual de conexi√≥n (verde/amarillo/rojo)
- ‚úÖ Validaci√≥n autom√°tica de datos del sensor
- ‚úÖ Sistema de logs para debugging
- ‚úÖ API REST para integraci√≥n con otros sistemas
- ‚úÖ Compatible con Windows, Linux y macOS

---

## üì¶ Requisitos previos

Antes de comenzar, aseg√∫rate de tener instalado:

### 1. Python 3.10 o superior
Verifica tu versi√≥n de Python:

**Windows (PowerShell):**
```powershell
python --version
```

**Linux/macOS:**
```bash
python3 --version
```

Si no tienes Python instalado, desc√°rgalo desde: https://www.python.org/downloads/

### 2. Git (opcional, pero recomendado)
Para clonar el repositorio. Descarga desde: https://git-scm.com/downloads

### 3. Navegador web moderno
Chrome, Firefox, Edge o Safari

---

## üöÄ Instalaci√≥n y configuraci√≥n

### PASO 1: Obtener el c√≥digo

#### Opci√≥n A: Clonar con Git
```bash
git clone https://github.com/henryor/Flask-iot-demo.git
cd Flask-iot-demo
```

#### Opci√≥n B: Descargar ZIP
1. Ve a https://github.com/henryor/Flask-iot-demo
2. Click en "Code" ‚Üí "Download ZIP"
3. Extrae el archivo
4. Abre la terminal en la carpeta extra√≠da

---

### PASO 2: Crear entorno virtual (Recomendado)

Un entorno virtual mantiene las dependencias aisladas de otros proyectos Python.

#### En Windows (PowerShell):
```powershell
# Crear el entorno virtual
python -m venv .venv

# Activarlo
.venv\Scripts\Activate.ps1
```

**Si aparece error de permisos:**
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

#### En Windows (CMD):
```cmd
python -m venv .venv
.venv\Scripts\activate.bat
```

#### En Linux/macOS:
```bash
python3 -m venv .venv
source .venv/bin/activate
```

**‚úÖ Sabr√°s que est√° activo cuando veas** `(.venv)` al inicio de tu l√≠nea de comandos.

---

### PASO 3: Instalar dependencias

Con el entorno virtual activado:

```bash
pip install -r requirements.txt
```

Esto instalar√°:
- **Flask 3.0.0**: Framework web para Python
- **python-dotenv 1.1.1**: Gestor de variables de entorno

---

### PASO 4: Configurar el servidor

#### 4.1. Copiar el archivo de configuraci√≥n

**En Windows (PowerShell):**
```powershell
Copy-Item .env.example .env
```

**En Linux/macOS:**
```bash
cp .env.example .env
```

#### 4.2. (Opcional) Editar configuraci√≥n

Abre el archivo `.env` con tu editor de texto favorito:

```env
FLASK_HOST=0.0.0.0          # Permite conexiones desde cualquier IP
FLASK_PORT=5000             # Puerto del servidor (puedes cambiarlo)
FLASK_DEBUG=true            # Modo desarrollo (muestra errores detallados)
STATUS_REFRESH_SECONDS=5    # Cada cu√°ntos segundos se actualiza el dashboard
```

**üí° Nota:** Para uso en clase, puedes dejar los valores por defecto.

---

### PASO 5: Iniciar el servidor

```bash
python app.py
```

**‚úÖ Si todo est√° correcto, ver√°s:**

```
2025-10-03 11:21:05,372 - __main__ - INFO - Starting Flask IoT server on 0.0.0.0:5000 (debug=True)
2025-10-03 11:21:05,373 - __main__ - INFO - Dashboard refresh interval: 5 seconds
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.0.7:5000
```

**üéâ ¬°El servidor est√° funcionando!**

**Para detener el servidor:** Presiona `Ctrl + C`

---

### PASO 6: Abrir el dashboard

1. Abre tu navegador web
2. Ve a: **http://localhost:5000**

**Deber√≠as ver:**
- üî¥ Badge rojo con "Offline" (es normal, a√∫n no hay datos)
- Panel con temperatura y humedad vac√≠os
- Mensaje "Esperando datos del microcontrolador..."

---

## üß™ Probar sin hardware (simulaci√≥n)

Ahora enviaremos datos simulados al servidor para ver c√≥mo funciona.

### Opci√≥n 1: PowerShell (Windows) ‚≠ê M√ÅS F√ÅCIL

Abre una **nueva terminal PowerShell** (sin cerrar la del servidor):

```powershell
# Copiar y pegar todo junto
$body = '{"temperature": 23.5, "humidity": 60}'
Invoke-RestMethod -Uri "http://localhost:5000/update" -Method POST -ContentType "application/json" -Body $body
```

### Opci√≥n 2: Bash (Linux/macOS/Git Bash)

Abre una **nueva terminal**:

```bash
curl -X POST http://localhost:5000/update \
  -H "Content-Type: application/json" \
  -d '{"temperature": 23.5, "humidity": 60}'
```

### Opci√≥n 3: Script de pruebas automatizado

Este script prueba m√∫ltiples escenarios (datos v√°lidos, inv√°lidos, fuera de rango):

```bash
python test_validation.py
```

---

### üéä ¬øQu√© deber√≠as ver?

**En el navegador (http://localhost:5000):**
1. üü¢ Badge cambia a verde con "Connected"
2. La temperatura muestra: **23.5¬∞C**
3. La humedad muestra: **60%**
4. La marca de tiempo se actualiza

**En la terminal del servidor:**
```
INFO - Sensor data updated: temp=23.5¬∞C, humidity=60%
```

**üí° Prueba enviar diferentes valores:**

```powershell
# Temperatura alta
$body = '{"temperature": 35.8, "humidity": 75}'
Invoke-RestMethod -Uri "http://localhost:5000/update" -Method POST -ContentType "application/json" -Body $body

# Temperatura fr√≠a
$body = '{"temperature": 10.2, "humidity": 45}'
Invoke-RestMethod -Uri "http://localhost:5000/update" -Method POST -ContentType "application/json" -Body $body
```

---

## üéÆ Usar con Wokwi (ESP32 simulado)

### PASO 1: Configurar el firmware

1. Ve a tu proyecto en Wokwi
2. Copia el archivo `firmware/config.h.example` a `config.h`
3. Edita los valores:

```cpp
#define WIFI_SSID "Wokwi-GUEST"
#define WIFI_PASSWORD ""

// Usa la IP de tu computadora (la que aparece en "Running on http://192.168.X.X:5000")
#define API_BASE_URL "http://host.docker.internal:5000"
#define API_UPDATE_PATH "/update"

// Debe coincidir con STATUS_REFRESH_SECONDS del .env
#define POST_INTERVAL_SECONDS 5
```

### PASO 2: Ejecutar en Wokwi

1. Inicia el servidor Flask en tu computadora
2. Inicia la simulaci√≥n en Wokwi
3. Observa la consola serial (deber√≠a mostrar `200 OK`)
4. Refresca el dashboard en tu navegador

**‚úÖ El badge debe cambiar a verde y mostrar los valores del sensor simulado**

---

## üîç Soluci√≥n de problemas

### ‚ùå Error: "python: command not found"

**Soluci√≥n Windows:**
```powershell
py app.py
```

**Soluci√≥n Linux/macOS:**
```bash
python3 app.py
```

---

### ‚ùå Error: "No module named 'flask'"

**Causa:** No instalaste las dependencias o el entorno virtual no est√° activado.

**Soluci√≥n:**
1. Activa el entorno virtual (ver PASO 2)
2. Ejecuta: `pip install -r requirements.txt`

---

### ‚ùå Badge permanece en rojo

**Posibles causas:**

1. **No has enviado datos:** Env√≠a datos con PowerShell/curl (ver secci√≥n "Probar sin hardware")

2. **Pasaron m√°s de 30 segundos desde el √∫ltimo dato:**
   - El sistema marca como "offline" si no hay datos en 30 segundos
   - Env√≠a nuevos datos

3. **Problema con Wokwi:**
   - Verifica que `API_BASE_URL` en `config.h` sea correcto
   - Revisa la consola serial para errores
   - Comprueba que el firewall permita conexiones al puerto 5000

---

### ‚ùå Error de validaci√≥n: "Temperature out of range"

**Causa:** El sensor est√° enviando valores fuera del rango permitido.

**Rangos v√°lidos:**
- Temperatura: -40¬∞C a 85¬∞C
- Humedad: 0% a 100%

**Soluci√≥n:** Verifica que el sensor DHT11/DHT22 est√© funcionando correctamente.

---

### ‚ùå El dashboard no se actualiza autom√°ticamente

**Soluci√≥n:**
1. Verifica que el toggle "Auto refresco" est√© activado (‚úÖ)
2. Abre la consola del navegador (F12) y busca errores
3. Refresca la p√°gina (F5)

---

## üì° Referencia de API

### Endpoints disponibles

| Endpoint | M√©todo | Descripci√≥n |
|----------|--------|-------------|
| `/` | GET | Dashboard HTML |
| `/update` | POST | Recibir datos del sensor |
| `/data` | GET | Obtener √∫ltimas lecturas |
| `/health` | GET | Estado del sistema |

---

### POST `/update` - Enviar datos del sensor

**Requisitos:**
- Content-Type: `application/json`
- Body: JSON con temperatura y humedad

**Ejemplo de petici√≥n:**
```json
{
  "temperature": 23.5,
  "humidity": 60
}
```

**Validaciones autom√°ticas:**
- ‚úÖ Temperatura: debe estar entre -40¬∞C y 85¬∞C
- ‚úÖ Humedad: debe estar entre 0% y 100%
- ‚úÖ Ambos campos son obligatorios
- ‚úÖ Los valores deben ser n√∫meros

**Respuesta exitosa (200):**
```json
{
  "status": "success",
  "connection": "connected",
  "data": {
    "temperature": 23.5,
    "humidity": 60
  },
  "last_update": "2025-10-03T16:21:05.123456+00:00"
}
```

**Respuesta de error (400):**
```json
{
  "error": "Temperature out of valid range (-40 to 85¬∞C)"
}
```

---

### GET `/data` - Obtener lecturas actuales

No requiere par√°metros.

**Respuesta:**
```json
{
  "data": {
    "temperature": 23.5,
    "humidity": 60
  },
  "last_update": "2025-10-03T16:21:05.123456+00:00",
  "connection": "connected"
}
```

---

### GET `/health` - Estado del servidor

√ötil para monitoreo y debugging.

**Respuesta:**
```json
{
  "status": "connected",
  "data": {
    "temperature": 23.5,
    "humidity": 60
  },
  "last_update": "2025-10-03T16:21:05.123456+00:00",
  "seconds_since_update": 2.5,
  "uptime_seconds": 120.8
}
```

**Estados posibles:**
- üü¢ `connected`: Recibi√≥ datos hace ‚â§10 segundos
- üü° `stale`: Recibi√≥ datos hace 10-30 segundos (conexi√≥n d√©bil)
- üî¥ `offline`: No hay datos o pasaron >30 segundos

---

## üìö Para profundizar

### Estructura del proyecto

```
Flask-iot-demo/
‚îú‚îÄ‚îÄ app.py                      # Servidor Flask principal
‚îú‚îÄ‚îÄ requirements.txt            # Dependencias Python
‚îú‚îÄ‚îÄ .env.example               # Plantilla de configuraci√≥n
‚îú‚îÄ‚îÄ test_validation.py         # Script de pruebas
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ index.html            # Dashboard HTML
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îî‚îÄ‚îÄ style.css             # Estilos CSS
‚îî‚îÄ‚îÄ firmware/
    ‚îî‚îÄ‚îÄ config.h.example      # Configuraci√≥n ESP32
```

### Tecnolog√≠as utilizadas

- **Backend:** Flask (Python)
- **Frontend:** HTML5, CSS3, JavaScript (Vanilla)
- **Firmware:** Arduino C++ (ESP32)
- **Simulador:** Wokwi

### Ideas para extender el proyecto

1. **Base de datos:** Guardar hist√≥rico de lecturas con SQLite
2. **Gr√°ficas:** Agregar Chart.js para visualizar tendencias
3. **Alertas:** Notificaciones cuando temperatura/humedad excedan l√≠mites
4. **Multi-sensor:** Soportar m√∫ltiples ESP32 simult√°neamente
5. **Autenticaci√≥n:** Login para proteger el dashboard
6. **PWA:** Convertir en Progressive Web App para usar en m√≥vil

---

## üìû Soporte

**¬øEncontraste un error?** Abre un issue en GitHub: https://github.com/henryor/Flask-iot-demo/issues

**¬øTienes preguntas?** Consulta con tu profesor o revisa la documentaci√≥n de Flask: https://flask.palletsprojects.com/

---

## üìÑ Licencia

Este proyecto es de c√≥digo abierto para fines educativos.

---

## üìù Historial de cambios

Consulta `CHANGELOG.md` para ver todas las actualizaciones del proyecto.
#   I O T _ 1 1 1 4  
 